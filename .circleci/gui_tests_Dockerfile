# This Dockerfile creates an image that has the necessary tools to run unit tests and publish coverage reports

FROM debian:buster

##### TODO: move some of this to gui.sh script
RUN apt-get update && \
    apt-get install build-essential python-pip lcov git curl -y && \
    pip install -U pip && \
    pip install codecov conan

WORKDIR /root/Ventilator
COPY . ./

WORKDIR /root/Ventilator/software/gui

##### TODO: move test run app in headless mode
CMD /bin/bash \
    export FORCED_ROOT=1 \
    ./gui.sh install && \
    ./gui.sh build -j --no-checks && \
    Xvfb :1 & DISPLAY=:1 ./build/bin/ventilator_gui_app --startup-only \
    ./gui.sh clean && \
    ./gui.sh test && \
    ./gui.sh cov_upload
