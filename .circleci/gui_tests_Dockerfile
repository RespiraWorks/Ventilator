# This Dockerfile creates an image that has the necessary tools to run unit tests and publish coverage reports

FROM debian:buster

# NOTE: pre-commit version is pinned to prevent installing a Python 3-only version.
RUN apt-get update && apt-get install build-essential python-pip lcov git curl -y \
    && pip install -U pip \
    && pip install pre-commit==1.21.0 codecov

WORKDIR /root/Ventilator
COPY . ./
CMD /bin/bash \
    software/gui/gui.sh --install && \
    software/gui/gui.sh --build && \
    software/gui/gui.sh --test && \
    curl https://codecov.io/bash > codecov_uploader.sh && \
    chmod +x codecov_uploader.sh && \
    ./codecov_uploader.sh
