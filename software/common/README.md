# Common code

This is code common to both the cycle controller and the GUI software. Some behavior ought to be intentionally and explicitly the same, such as things related communications protocol and interpretation of physical units.

## Contents

* [libs](libs) - these are custom authored libraries that will be shared by both pieces of deployed software. They should all be tested.
* [generated_libs/protocols](generated_libs/protocols) - communications protocol definitions for generating serialization code, used by both pieces of deployed software, but needs not be tested
* [test](test) - these are unit tests for the shared libraries
* [test_libs](test_libs) - these are libraries only used for the purpose of testing, but are themselves not part of the deployed code
* [common.sh](common.sh) - general utility script for running tests and reporting test coverage
* [platformio.ini](platformio.ini) - something like a "make file" which governs how platformio builds, here just for the unit tests

## Building the protocols

The communications protocols define messages sent between the ventilator's microcontroller and the computer controlling its GUI. The protocols are automatically generated by nanopb and protobuf. The C and Python libraries need to be generated before the controller, GUI or debugger code can make use of the protocol.

The C and Python code can be generated by calling `common.sh generate`. The generated code is not meant to be committed to the repository because it is not really the source. The protocols defined here in [generated_libs/protocols/network_protocol.proto](generated_libs/protocols/network_protocol.proto) indeed are.

## Testing

There is nothing here to build as an executable, but unit tests should be run. We are using the platformio toolchain to do this, just like for the controller. For notes on installing platformio and integrating it with your IDE, see the [controller](../controller) documentation page.
