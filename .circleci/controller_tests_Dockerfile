# This Dockerfile creates an image that has the necessary tools to run unit tests and publish coverage reports

FROM debian:buster

RUN apt-get update && apt-get -y install sudo
RUN useradd -m docker && echo "docker:docker" | chpasswd && adduser docker sudo
USER docker

WORKDIR /root/Ventilator

COPY . ./

WORKDIR /root/Ventilator/software/controller

ENV FORCED_ROOT=1

CMD /bin/bash \
    ./controller.sh install && \
    ./controller.sh test --cov --no-checks && \
    ./controller.sh cov_upload
